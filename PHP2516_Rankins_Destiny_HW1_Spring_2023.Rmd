---
title: "PHP2516_Rankins_Destiny_HW1_Spring_2023"
output: html_document
date: "2023-02-14"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

#read_dta("C:/Users/nicka/Documents/Datasets/TLC.dta")
lead <- read_dta("C:/Users/desti/Downloads/lead.dta")
head(lead)
```

Problem 2.1.1
Read the data from the external file and calculate the sample means, standard
deviations, and variances of the blood lead levels at each occasion.
```{r}
#calulate the mean of the blood levels at each occasion
means <-
(c(
mean(lead$y1),
mean(lead$y2),
mean(lead$y3),
mean(lead$y4)))

#calculate the standard deviation of the blood levels at each occasion
sds <-
(c(sd(lead$y1),
sd(lead$y2),
sd(lead$y3),
sd(lead$y4)))

#calculate the variance of the blood levels at each occasion
vars<-(
c(var(lead$y1),
var(lead$y2),
var(lead$y3),
var(lead$y4)))

x <- data.frame(means, sds, vars)

kbl(x)


```

Problem 2.1.2
2.1.2 Construct a time plot of the mean blood lead levels versus time (in weeks).
Describe the general characteristics of the time trend.
```{r}
#Time plot 




```

Problem 2.1.3
Calculate the 4 x 4 covariance and correlation matrices for the four repeated
measures of blood lead levels.
```{r}
#Covariance Matrix for the blood levels
cov(lead[,c('Week_1', 'Week_2','Week_3', 'Week_4')]),

#Correlation matrix for the blood levels
cor(lead[,c('Week_1', 'Week_2','Week_3', 'Week_4')])
```

Problem 2.1.4
Verify that the diagonal elements of the covariance matrix are the variances by
comparing to the descriptive statistics obtained in Problem 2.1.1.
```{r}
cov(lead[,c('Week_1', 'Week_2','Week_3', 'Week_4')])

#variance
vars
```

Problem 2.1.5
Verify that the correlation between blood lead levels at baseline (week 0) and
week 1 is equal to the covariance between blood lead levels at baseline and
week 1, divided by the product of the standard deviations of the blood lead
levels at baseline and week 1.
```{r}

```

QUESTION 2:

```{r}
calcium_all <- read.csv("C:/Users/desti/Downloads/calcium_all.csv")
head(calcium_all)

ggplot(data=calcium_all, aes(x=age, y=bmd, group=visit)) +
  geom_line(aes(color=visit)) +
  geom_point(aes(color=visit))+
  #scale_color_brewer(palette="Dark2")+
  facet_wrap(~group)+
  ylab(~ paste(" Lead levels ( ",mu,"g/dL )"))+
  xlab("Time (weeks)")

ggplot(data=calcium_all, aes(x=age, y=bmd, group=visit)) +
  geom_point(aes(color=visit))+
  #scale_color_brewer(palette="Dark2")+
  facet_wrap(~group)+
  ylab(~ paste(" Lead levels ( ",mu,"g/dL )"))+
  xlab("Time (weeks)")

ggplot(data=calcium_all, aes(x=age, y=bmd, fill=visit)) +
  geom_boxplot() +
  facet_wrap(.~group)

```

QUESTION 3
Comment on the results from both descriptive statistics and plots. What 
are your conclusions regarding:
a) changes in variables over time?
b) variability?
c) association among measurements?
d) comparisons between the two treatment groups?
```{r}

calcium_summary <- calcium_all %>% group_by(visit, group) %>% 
  summarise(mean = round(mean(bmd, na.rm = TRUE),3),
            sd = round(sd(bmd, na.rm = TRUE),3),
            var = round(var(bmd, na.rm = TRUE),3))

calcium_mean <- ggplot(data = calcium_summary, aes(x = visit, y = mean, col= group)) +
  geom_point(size = 1.5) +
  geom_line() +
  xlab("Visit ") +
 ylab(~ paste(" Bone Mineral Density (in g/cm2)")) +
   theme(axis.line = element_line(colour = "black",linewidth=1),
        text = element_text(size=14),
        axis.text = element_text(colour = "black",size = 14),
        axis.title = element_text(size = 14),
        axis.ticks.length=unit(.25, "cm"),
        axis.ticks = element_line(colour = "black", linewidth = 1.5), 
        legend.background = element_blank())+
  labs(title = "Mean Bone Mineral Density Levels")

calcium_mean


calcium_all$group <- as.factor(calcium_all$group)
calcium_all$visit <- as.factor(calcium_all$visit)
fit.comsym <- gls(bmd ~ factor(group)*factor(visit), data=calcium_all,
                  corr=corCompSymm(, form = ~ factor(visit)| person),
                  weights=varIdent(form = ~1 | factor(visit)))
summary(fit.comsym)
anova(fit.comsym)

```

QUESTION 4:
Is the bmd change over time the same between the two treatment 
groups? Use appropriate statistical testing to support your answer. Comment on the results.

